#!/usr/bin/env bash
#
# Script: configure_nginx_port_80.sh
# Description: Configures Nginx to listen on port 80 for all active IPv4 IPs

# Check if Nginx is already listening on port 80
if curl -s -m 2 0:80 >/dev/null; then
  echo "Nginx is already listening on port 80"
  exit 0
fi

# Install Nginx if it's not already installed
if ! command -v nginx >/dev/null; then
  sudo apt update
  sudo apt install -y nginx
fi

# Configure Nginx to listen on port 80
sed -i 's/#listen 80;/listen 80;/' /etc/nginx/nginx.conf

# Restart Nginx service
systemctl restart nginx

# Check if Nginx is now listening on port 80
if curl -s -m 2 0:80 >/dev/null; then
  echo "Nginx is now listening on port 80"
else
  echo "Failed to configure Nginx to listen on port 80"
fi
